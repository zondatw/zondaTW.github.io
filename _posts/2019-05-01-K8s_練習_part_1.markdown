---
layout: post
title:  "K8s ç·´ç¿’ - part 1"
date:   2019-05-01 08:33:00 +0800
categories: K8s
---
ä¹‹å‰å°±æƒ³ç©ç©K8sï¼Œæ‰€ä»¥å°±æŠ½ç©ºä¾†ç©ç©å–½~  

## Install

é€™é‚Šä¸»è¦å…ˆæŠŠ[minikube][install_minikube]è£èµ·ä¾†(ä»¥ä¸‹ç’°å¢ƒç‚ºArchlinux)

1. install virtualbox  
    * `sudo pacman -S virtualbox`
    * é¸æ“‡ virtualbox-host-modules-arch
    * `sudo modprobe vboxdrv`
2. `curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
  && chmod +x minikube`  
3. `sudo cp minikube /usr/local/bin/. && rm minikube`  
4. Install [kubectl][install_kubectl]:
    * `curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl `
    * `chmod +x ./kubectl`  
    * `sudo mv ./kubectl /usr/local/bin/kubectl`


## start

æŸ¥çœ‹ç›®å‰ç‰ˆæœ¬  

```text
$ minikube version
minikube version: v1.0.1
```

é–‹å§‹ï¼Œç¬¬ä¸€æ¬¡å•Ÿå‹•æ™‚æœƒè·‘å¾ˆä¹…ï¼Œå› ç‚ºè¦æŠŠç’°å¢ƒè£èµ·ä¾†  

```text
$ minikube start
ğŸ˜„  minikube v1.0.1 on linux (amd64)
ğŸ’¿  Downloading Minikube ISO ...
 142.88 MB / 142.88 MB [============================================] 100.00% 0s
ğŸ¤¹  Downloading Kubernetes v1.14.1 images in the background ...
ğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=2048MB, Disk=20000MB) ...
ğŸ“¶  "minikube" IP address is 192.168.99.100
ğŸ³  Configuring Docker as the container runtime ...
ğŸ³  Version of container runtime is 18.06.3-ce
âŒ›  Waiting for image downloads to complete ...
âœ¨  Preparing Kubernetes environment ...
ğŸ’¾  Downloading kubelet v1.14.1
ğŸ’¾  Downloading kubeadm v1.14.1
ğŸšœ  Pulling images required by Kubernetes v1.14.1 ...
ğŸš€  Launching Kubernetes v1.14.1 using kubeadm ... 
âŒ›  Waiting for pods: apiserver proxy etcd scheduler controller dns
ğŸ”‘  Configuring cluster permissions ...
ğŸ¤”  Verifying component health .....
ğŸ’—  kubectl is now configured to use "minikube"
ğŸ’¡  For best results, install kubectl: https://kubernetes.io/docs/tasks/tools/install-kubectl/
ğŸ„  Done! Thank you for using minikube!
```

æŸ¥çœ‹ç‹€æ…‹  

```text
$ minikube status
host: Running
kubelet: Running
apiserver: Running
kubectl: Correctly Configured: pointing to minikube-vm at 192.168.99.100
```

```text
$ kubectl cluster-info
Kubernetes master is running at https://192.168.99.100:8443
KubeDNS is running at https://192.168.99.100:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
```

config  

```text
$ cat .kube/config 
apiVersion: v1
clusters:
- cluster:
    certificate-authority: /home/zonda/.minikube/ca.crt
    server: https://192.168.99.100:8443
  name: minikube
contexts:
- context:
    cluster: minikube
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: {}
users:
- name: minikube
  user:
    client-certificate: /home/zonda/.minikube/client.crt
    client-key: /home/zonda/.minikube/client.key
```

åœ–å½¢åŒ–æ“ä½œ  

```text
$ minikube dashboard
```

![](/assets\images\2019-05-01-K8s-exercise_part_1\k8s_dashboard.png)

åŸ·è¡Œhello-minikube:  

```text
$ kubectl run hello-minikube --image=k8s.gcr.io/echoserver:1.10 --port=8080
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/hello-minikube created
```

æŸ¥çœ‹podsç‹€æ…‹:  

```text
$ kubectl get pods
NAME                              READY   STATUS              RESTARTS   AGE
hello-minikube-56cdb79778-trxx9   0/1     ContainerCreating   0          108s
```

å°å¤–å…¬é–‹æ‡‰ç”¨:  
é€ékubectl exposeå¯ä»¥è®“å¤–é¢é€£åˆ°`hello-minikube`é€™å€‹æœå‹™  

```text
$ kubectl expose deployment hello-minikube --type=NodePort
service/hello-minikube exposed

$ kubectl get pods
NAME                              READY   STATUS    RESTARTS   AGE
hello-minikube-56cdb79778-trxx9   1/1     Running   0          27m

$ kubectl get services
NAME             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
hello-minikube   NodePort    10.103.163.153   <none>        8080:30337/TCP   28m
kubernetes       ClusterIP   10.96.0.1        <none>        443/TCP          11h

$ minikube service hello-minikube --url
http://192.168.99.100:30337
```

é€£ä¸Šhttp://192.168.99.100:30337æœƒå‡ºç¾  

```text
Hostname: hello-minikube-56cdb79778-trxx9

Pod Information:
	-no pod information available-

Server values:
	server_version=nginx: 1.13.3 - lua: 10008

Request Information:
	client_address=172.17.0.1
	method=GET
	real path=/
	query=
	request_version=1.1
	request_scheme=http
	request_uri=http://192.168.99.100:8080/

Request Headers:
	accept=text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
	accept-encoding=gzip, deflate
	accept-language=en-US,en;q=0.5
	connection=keep-alive
	host=192.168.99.100:30337
	upgrade-insecure-requests=1
	user-agent=Mozilla/5.0 (X11; Linux x86_64; rv:66.0) Gecko/20100101 Firefox/66.0

Request Body:
	-no body in request-
```



[install_minikube]:https://kubernetes.io/docs/tasks/tools/install-minikube/  
[install_kubectl]:https://kubernetes.io/docs/tasks/tools/install-kubectl/  